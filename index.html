<!DOCTYPE html>
<html lang="tr" style="scroll-behavior: smooth;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PİKSENFONİ - Bütünleşik Deneyim</title>
    
    <!-- Gerekli kütüphaneler -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getDatabase, ref, onValue, onDisconnect, set, serverTimestamp, push } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyC77aQt7K6CicZYwgcxgLEH8sGmErcbkdc",
            authDomain: "holodvision-piksenfoni.firebaseapp.com",
            databaseURL: "https://holodvision-piksenfoni-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "holodvision-piksenfoni",
            storageBucket: "holodvision-piksenfoni.firebasestorage.com",
            messagingSenderId: "924131810834",
            appId: "1:924131810834:web:abf8f10b5250e38fc702cb"
        };

        const app = initializeApp(firebaseConfig);
        window.firebaseDb = getDatabase(app);
        window.firebaseRef = ref;
        window.firebaseOnValue = onValue;
        window.firebaseOnDisconnect = onDisconnect;
        window.firebaseSet = set;
        window.firebasePush = push;
        window.serverTimestamp = serverTimestamp;
    </script>

    <!-- Temel stiller -->
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #0c0a18;
            color: #fff;
            overflow-x: hidden;
        }
        #root {
            transition: background-color 0.5s ease;
        }
        #qr-reader video { border-style: none !important; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1a1a2e; }
        ::-webkit-scrollbar-thumb { background: #e94560; border-radius: 10px; }
        .fade-in-section {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }
        .fade-in-section.is-visible {
            opacity: 1;
            transform: translateY(0);
        }
        input[type=range] { -webkit-appearance: none; background: transparent; cursor: pointer; width: 100px; }
        input[type=range]:focus { outline: none; }
        input[type=range]::-webkit-slider-runnable-track { background: #4a5568; height: 4px; border-radius: 2px; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; margin-top: -6px; background-color: #e94560; height: 16px; width: 16px; border-radius: 50%; }
        input[type=range]::-moz-range-track { background: #4a5568; height: 4px; border-radius: 2px; }
        input[type=range]::-moz-range-thumb { border: none; border-radius: 50%; background-color: #e94560; height: 16px; width: 16px; }
        
        .blinking-cursor {
            animation: blink 1s step-end infinite;
        }
        @keyframes blink {
            from, to { color: transparent; }
            50% { color: #34d399; }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ICON BILEŞENLERİ (SVG) ---
        const EyeIcon = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>);
        const MusicIcon = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>);
        const RssIcon = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M4 11a9 9 0 0 1 9 9"/><path d="M4 4a16 16 0 0 1 16 16"/><circle cx="5" cy="19" r="1"/></svg>);
        const XCircleIcon = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>);
        const LoaderIcon = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="animate-spin" {...props}><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>);
        const SparklesIcon = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m12 3-1.9 5.8-5.8 1.9 5.8 1.9L12 18l1.9-5.8 5.8-1.9-5.8-1.9L12 3z"/><path d="M5 3v4"/><path d="M19 17v4"/><path d="M3 5h4"/><path d="M17 19h4"/></svg>);
        const CameraIcon = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></svg>);
        const Volume2Icon = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg>);
        const VolumeXIcon = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><line x1="23" y1="9" x2="17" y2="15"/><line x1="17" y1="9" x2="23" y2="15"/></svg>);
        const HomeIcon = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>);
        const FileTextIcon = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></svg>);
        const MailIcon = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>);
        const SettingsIcon = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2l.15-.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>);
        const MicOffIcon = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><line x1="1" y1="1" x2="23" y2="23"/><path d="M9 9v3a3 3 0 0 0 5.12 2.12M15 9.34V4a3 3 0 0 0-5.94-.6"/><path d="M17 16.95A7 7 0 0 1 5 12v-2m14 0v2a7 7 0 0 1-.11 1.23"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>);
        const UploadIcon = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>);
        const UsersIcon = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>);
        const ClockIcon = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>);

        // --- YARDIMCI BİLEŞENLER ve FONKSİYONLAR ---
        
        const speakText = (text, elevenLabsApiKey) => {
            const elevenLabsAudio = new Audio();

            return new Promise(async (resolve, reject) => {
                window.speechSynthesis.cancel();
                if (elevenLabsAudio && !elevenLabsAudio.paused) {
                    elevenLabsAudio.pause();
                    elevenLabsAudio.currentTime = 0;
                }

                if (elevenLabsApiKey && elevenLabsApiKey.length > 10) {
                    const VOICE_ID = '21m00Tcm4TlvDq8ikWAM';
                    const url = `https://api.elevenlabs.io/v1/text-to-speech/${VOICE_ID}`;
                    const options = {
                        method: 'POST',
                        headers: { 'Accept': 'audio/mpeg', 'Content-Type': 'application/json', 'xi-api-key': elevenLabsApiKey },
                        body: JSON.stringify({ text, model_id: 'eleven_multilingual_v2', voice_settings: { stability: 0.5, similarity_boost: 0.75 } }),
                    };
                    try {
                        const response = await fetch(url, options);
                        if (!response.ok) throw new Error(`HTTP ${response.status}`);
                        const audioBlob = await response.blob();
                        const audioUrl = URL.createObjectURL(audioBlob);
                        elevenLabsAudio.src = audioUrl;
                        elevenLabsAudio.onended = resolve;
                        elevenLabsAudio.onerror = reject;
                        await elevenLabsAudio.play();
                    } catch (error) {
                        console.error("ElevenLabs API hatası. Tarayıcı sesine geçiliyor:", error);
                        speakWithBrowser(text, resolve, reject);
                    }
                } else {
                    speakWithBrowser(text, resolve, reject);
                }
            });
        };

        const speakWithBrowser = (text, resolve, reject) => {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'tr-TR';
            utterance.rate = 0.9;
            utterance.onend = resolve;
            utterance.onerror = (e) => {
                console.error("SpeechSynthesis Hatası:", e);
                reject(e);
            };
            window.speechSynthesis.speak(utterance);
        };

        const useOnScreen = (options) => { const ref = useRef(null); const [isVisible, setIsVisible] = useState(false); useEffect(() => { const observer = new IntersectionObserver(([entry]) => { if (entry.isIntersecting) { setIsVisible(true); observer.unobserve(entry.target); } }, options); const currentRef = ref.current; if (currentRef) observer.observe(currentRef); return () => { if (currentRef) observer.unobserve(currentRef); }; }, [ref, options]); return [ref, isVisible]; };
        const AnimatedSection = ({ children, ...props }) => { const [ref, isVisible] = useOnScreen({ threshold: 0.1 }); return ( <div ref={ref} className={`fade-in-section ${isVisible ? 'is-visible' : ''} py-16 px-4 sm:px-6 lg:px-8 min-h-screen flex items-center justify-center`} {...props}> {children} </div> ); };
        const Notification = ({ message, onClear }) => { if (!message) return null; useEffect(() => { const timer = setTimeout(() => { onClear(); }, 4000); return () => clearTimeout(timer); }, [message, onClear]); return ( <div className="fixed bottom-5 left-1/2 -translate-x-1/2 bg-red-600 text-white py-3 px-6 rounded-lg shadow-lg z-[100] transition-transform animate-bounce"> {message} </div> ); };
        
        const ApiKeyModal = ({ isOpen, onClose, onSave }) => {
            const [geminiKey, setGeminiKey] = useState("");
            const [elevenLabsKey, setElevenLabsKey] = useState("");

            useEffect(() => {
                if (isOpen) {
                    setGeminiKey(localStorage.getItem("geminiApiKey") || "");
                    setElevenLabsKey(localStorage.getItem("elevenLabsApiKey") || "");
                }
            }, [isOpen]);

            const handleSave = () => {
                onSave({ gemini: geminiKey, elevenLabs: elevenLabsKey });
                onClose();
            };

            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                    <div className="bg-gray-900 p-6 rounded-2xl shadow-2xl border border-gray-700 w-full max-w-md">
                        <h2 className="text-2xl font-bold text-white mb-4">API Anahtarları</h2>
                        <div className="mb-4">
                            <label className="block text-gray-400 mb-2">Google AI API Anahtarı</label>
                            <input 
                                type="text"
                                value={geminiKey}
                                onChange={(e) => setGeminiKey(e.target.value)}
                                className="w-full p-3 bg-gray-800 border border-gray-600 rounded-lg text-white"
                                placeholder="Google AI anahtarınızı yapıştırın"
                            />
                        </div>
                        <div className="mb-6">
                            <label className="block text-gray-400 mb-2">ElevenLabs API Anahtarı</label>
                            <input 
                                type="text"
                                value={elevenLabsKey}
                                onChange={(e) => setElevenLabsKey(e.target.value)}
                                className="w-full p-3 bg-gray-800 border border-gray-600 rounded-lg text-white"
                                placeholder="ElevenLabs anahtarınızı yapıştırın"
                            />
                        </div>
                        <div className="flex justify-end gap-4">
                            <button onClick={onClose} className="text-gray-400 hover:text-white transition-colors">İptal</button>
                            <button onClick={handleSave} className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">Kaydet</button>
                        </div>
                    </div>
                </div>
            );
        };

        const VisitorStatsModal = ({ isOpen, onClose, onlineUsers, totalVisits }) => {
            const formatTimeAgo = (timestamp) => {
                const now = Date.now();
                const seconds = Math.floor((now - timestamp) / 1000);
                if (seconds < 60) return "az önce";
                const minutes = Math.floor(seconds / 60);
                if (minutes < 60) return `${minutes} dakika önce`;
                const hours = Math.floor(minutes / 60);
                return `${hours} saat önce`;
            };

            if (!isOpen) return null;

            return (
                 <div className="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                    <div className="bg-gray-900 p-6 rounded-2xl shadow-2xl border border-gray-700 w-full max-w-md">
                        <div className="flex justify-between items-center mb-4">
                            <h2 className="text-2xl font-bold text-white">Ziyaretçi İstatistikleri</h2>
                            <button onClick={onClose} className="text-gray-400 hover:text-white transition-colors"><XCircleIcon size={28} /></button>
                        </div>
                        <div className="space-y-4">
                            <div>
                                <h3 className="text-lg font-semibold text-pink-400 mb-2">Genel İstatistikler</h3>
                                <p className="text-gray-300">Toplam Ziyaret Sayısı: <span className="font-bold text-white">{totalVisits}</span></p>
                            </div>
                            <div>
                                <h3 className="text-lg font-semibold text-pink-400 mb-2">Aktif Ziyaretçiler ({onlineUsers.length})</h3>
                                <ul className="space-y-2 max-h-48 overflow-y-auto">
                                    {onlineUsers.map(user => (
                                        <li key={user.id} className="flex items-center gap-2 text-gray-300">
                                            <ClockIcon className="h-4 w-4" />
                                            <span>Giriş: {formatTimeAgo(user.loginTime)}</span>
                                        </li>
                                    ))}
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- BAŞLANGIÇ EKRANI ---
        const WelcomeScreen = ({ onStart }) => {
            return (
                <div className="min-h-screen w-full flex flex-col items-center justify-center text-center p-4 bg-gradient-to-b from-[#0c0a18] to-[#1a1a2e]">
                    <img src="https://raw.githubusercontent.com/Sev84/Holodvision-Demo/main/logo1111111.png" alt="PİKSENFONİ Logosu" className="mx-auto mb-8 h-40 animate-pulse"/>
                    <div className="bg-gray-800/70 backdrop-blur-sm p-8 rounded-2xl shadow-2xl border border-pink-500 max-w-2xl mx-auto">
                        <h1 className="text-5xl font-bold text-pink-400 mb-6">PİKSENFONİ'ye Hoş Geldiniz!</h1>
                        <p className="text-lg text-gray-300 mb-8">
                            Renklerle seslerin buluştuğu bu sınırsız dünyada, sanatı herkes için erişilebilir kılıyoruz. Deneyime başlamak için lütfen aşağıdaki düğmeye tıklayın.
                        </p>
                        <button 
                            onClick={onStart}
                            className="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-bold py-4 px-10 rounded-full shadow-lg transition-all transform hover:scale-105 flex items-center justify-center mx-auto text-xl"
                        >
                            <Volume2Icon className="mr-3" size={28} /> Deneyime Başla
                        </button>
                    </div>
                </div>
            );
        };
        
        // --- SAYFA GÖRÜNÜM BİLEŞENLERİ ---

        const AnaSayfaView = () => (
            <div className="flex flex-col items-center justify-center text-center w-full">
                <img src="https://raw.githubusercontent.com/Sev84/Holodvision-Demo/main/logo1111111.png" alt="PİKSENFONİ Logosu" className="mx-auto mb-8 h-40"/>
                <h1 className="text-6xl font-bold text-pink-400 mb-4 tracking-wider">PİKSENFONİ</h1>
                <p className="text-xl text-gray-300 max-w-2xl mx-auto">
                    Renklerle Seslerin Buluştuğu Sınırsız Dünya: Sanatı herkes için erişilebilir kılıyoruz.
                </p>
                <p className="text-lg text-gray-400 mt-8">
                    Deneyime devam etmek için yukarıdaki menüden bir bölüm seçin.
                </p>
            </div>
        );

        const ArtCard = ({ item, onSelect }) => (
            <div className="bg-gray-800/50 backdrop-blur-sm border border-gray-700 rounded-xl overflow-hidden shadow-lg transform hover:scale-105 transition-transform duration-300 cursor-pointer" onClick={() => onSelect(item)}>
                <img src={item.imageUrl} alt={item.artwork} className="w-full h-56 object-cover" onError={(e) => { e.target.src=`https://placehold.co/600x400/1f2937/ffffff?text=Resim+Yüklenemedi`; }}/>
                <div className="p-4">
                    <h3 className="text-xl font-bold text-red-300">{item.artwork}</h3>
                    <p className="text-sm text-gray-300 mb-2">{item.artist}</p>
                    <p className="text-sm text-gray-400 h-16 overflow-hidden">{item.description}</p>
                </div>
            </div>
        );
        
        const ArtworkDetailModal = ({ artwork, onClose }) => { 
            const [analysisText, setAnalysisText] = useState("");

            const getArtAnalysis = () => {
                const text = artwork.fallbackAnalysis;
                setAnalysisText(text);
                speakText(text, localStorage.getItem("elevenLabsApiKey")).catch(err => console.error("Analiz seslendirme hatası:", err));
            };

            const handleClose = () => {
                window.speechSynthesis.cancel();
                onClose();
            };

            if (!artwork) return null; 

            return ( 
                <div className="fixed inset-0 bg-black/80 backdrop-blur-md flex items-center justify-center z-40 p-4"> 
                    <div className="bg-gradient-to-br from-gray-900 to-[#1a1a2e] p-6 rounded-2xl shadow-2xl border border-red-500/50 max-w-2xl w-full max-h-[90vh] overflow-y-auto"> 
                        <div className="flex justify-between items-start mb-4"> 
                            <div> 
                                <h2 className="text-3xl font-bold text-red-400">{artwork.artwork}</h2> 
                                <p className="text-gray-300 text-lg">{artwork.artist}</p> 
                            </div> 
                            <button onClick={handleClose} className="text-gray-400 hover:text-white transition-colors"><XCircleIcon size={28} /></button> 
                        </div> 
                        <img src={artwork.imageUrl} alt={artwork.artwork} className="w-full h-72 object-cover rounded-lg mb-4" onError={(e) => { e.target.src=`https://placehold.co/600x400/1f2937/ffffff?text=Resim+Yüklenemedi`; }}/> 
                        <audio controls autoPlay className="w-full mb-4" src={artwork.musicUrl}>Tarayıcınız ses çalmayı desteklemiyor.</audio> 
                        <p className="text-gray-300 mb-6 text-base">{artwork.description}</p> 
                        <div className="pt-6 border-t border-gray-700">
                            <button onClick={getArtAnalysis} className="w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center transition-all">
                                <SparklesIcon className="mr-2" />
                                ✨ Sanatsal Analiz Al
                            </button>
                            {analysisText && (
                                <div className="mt-4 p-4 bg-gray-900/70 rounded-lg">
                                    <h4 className="font-bold text-lg text-red-300 mb-2">Sanatsal Analiz</h4>
                                    <p className="text-gray-300 whitespace-pre-wrap">{analysisText}</p>
                                </div>
                            )}
                        </div>
                    </div> 
                </div> 
            ); 
        };

        const QrScannerModal = ({ onScanSuccess, onScanError, onStop }) => {
            const [isCameraScanning, setIsCameraScanning] = useState(false);
            const fileInputRef = useRef(null);
            const html5QrCodeRef = useRef(null);

            useEffect(() => {
                html5QrCodeRef.current = new Html5Qrcode("qr-reader-placeholder");
                
                return () => {
                    if (html5QrCodeRef.current && html5QrCodeRef.current.isScanning) {
                        html5QrCodeRef.current.stop().catch(err => console.error("Tarama durdurulamadı.", err));
                    }
                };
            }, []);

            const startCameraScan = () => {
                setIsCameraScanning(true);
                const qrCodeSuccessCallback = (decodedText, decodedResult) => {
                    onScanSuccess(decodedText);
                };
                const config = { fps: 10, qrbox: { width: 250, height: 250 } };
                html5QrCodeRef.current.start({ facingMode: "environment" }, config, qrCodeSuccessCallback)
                    .catch(err => {
                        onScanError("Kamera başlatılamadı. Lütfen kamera izni verdiğinizden emin olun.");
                    });
            };

            const handleFileChange = async (event) => {
                const file = event.target.files[0];
                if (file) {
                    try {
                        const decodedText = await html5QrCodeRef.current.scanFile(file, false);
                        onScanSuccess(decodedText);
                    } catch (err) {
                        onScanError("Bu resimde QR kod bulunamadı veya okunamadı.");
                    }
                }
            };

            return (
                <div className="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                    <div className="bg-gray-900 p-6 rounded-2xl shadow-2xl border border-gray-700 w-full max-w-md">
                        <h2 className="text-2xl font-bold text-white mb-4 text-center">QR Kod Tara</h2>
                        
                        <div id="qr-reader-placeholder" className={`rounded-lg overflow-hidden ${!isCameraScanning ? 'hidden' : ''}`}></div>

                        {!isCameraScanning && (
                            <div className="flex flex-col gap-4">
                                <button onClick={startCameraScan} className="w-full p-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg flex items-center justify-center">
                                    <CameraIcon className="mr-2" /> Kamera ile Tara
                                </button>
                                <button onClick={() => fileInputRef.current.click()} className="w-full p-3 bg-purple-600 hover:bg-purple-700 text-white font-bold rounded-lg flex items-center justify-center">
                                    <UploadIcon className="mr-2" /> Resim Yükle
                                </button>
                                <input
                                    type="file"
                                    ref={fileInputRef}
                                    onChange={handleFileChange}
                                    accept="image/*"
                                    className="hidden"
                                />
                            </div>
                        )}
                        
                        <button onClick={onStop} className="w-full mt-4 bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg flex items-center justify-center transition-colors">
                            <XCircleIcon className="mr-2" /> Kapat
                        </button>
                    </div>
                </div>
            );
        };

        const GalleryView = ({setNotification}) => {
            const [allArtworks, setAllArtworks] = useState([]);
            const [filteredArtworks, setFilteredArtworks] = useState([]);
            const [selectedArtwork, setSelectedArtwork] = useState(null);
            const [filterCategory, setFilterCategory] = useState("Tümü");
            const [isLoading, setIsLoading] = useState(true);
            const [isScanning, setIsScanning] = useState(false);
            
            useEffect(() => {
                const repoBaseUrl = "https://raw.githubusercontent.com/Sev84/Holodvision-Demo/main/";
                const artworksData = [
                    { 
                        "id": 1, "artwork": "Mona Lisa", "qr": "MONA_ORJ", "musicUrl": `${repoBaseUrl}Monalisa%20Son%20Hali.mp3`, "imageUrl": `${repoBaseUrl}Monalisa.jpeg`, "artist": "Leonardo da Vinci", 
                        "description": "Rönesans'ın simgesi haline gelmiş, gizemli gülümsemesiyle milyonları büyüleyen bu portre, sfumato tekniğinin en bilinen örneğidir.", "category": "Klasik",
                        "fallbackAnalysis": "Ben, Leonardo da Vinci'nin fırçasından çıkmış en gizemli gülümsemeyim. Ustam, 'sfumato' adını verdiği bir teknikle, çizgileri ve sınırları bir sis perdesinin ardında eriterek bana bu yumuşak ve canlı ifadeyi verdi. Arka plandaki hayali manzara, benim zamansız ve mekansız duruşumu güçlendirir."
                    },
                    { 
                        "id": 2, "artwork": "İnci Küpeli Kız", "qr": "INCI_ORJ", "musicUrl": `${repoBaseUrl}Inci%20Kupeli%20Kız%20Son%20Hali.mp3`, "imageUrl": `${repoBaseUrl}Inci%20Kupeli%20Kız.jpeg`, "artist": "Johannes Vermeer", 
                        "description": "Hollanda'nın Mona Lisa'sı olarak bilinen bu eser, anlık bir bakışın ve ışığın ustaca kullanımının yarattığı duygu yoğunluğuyla tanınır.", "category": "Klasik",
                        "fallbackAnalysis": "Ustam Vermeer, bir anın büyüsünü yakalamakta ustaydı. Omzumun üzerinden sana dönerkenki o anlık bakışım, karanlık bir arka plandan fırlayan ışıkla aydınlanır. Gözlerimdeki merak ve dudağımdaki hafif aralık, sana söylenmemiş bir sırrı fısıldar. İnci küpem ise, tüm bu sadeliğin ortasında parlayan bir umut gibidir."
                    },
                    { 
                        "id": 5, "artwork": "İnci Küpeli Kız (Kübist)", "qr": "INCI_KUP", "musicUrl": `${repoBaseUrl}Inci%20Kupeli%20Kız%20Son%20Hali.mp3`, "imageUrl": `${repoBaseUrl}Inci%20Kupeli%20Kız1.jpg`, "artist": "Johannes Vermeer (Yorum)", 
                        "description": "Vermeer'in başyapıtının, geometrik formlar ve parçalanmış perspektiflerle modern bir sanat akımı olan Kübizm ile yeniden yorumlanması.", "category": "Kübist",
                        "fallbackAnalysis": "Ben, tanıdığınız o masum kızın, 20. yüzyılın gözünden görülen haliyim. Formlarım parçalandı, yüzüm farklı açılardan aynı anda size bakıyor. Bu, modern dünyanın karmaşasını ve bir nesneye tek bir noktadan bakılamayacağı fikrini temsil eder. Duygularım artık geometrik şekillerin içinde gizli."
                    },
                    { 
                        "id": 6, "artwork": "Olga (Kübist)", "qr": "PICA_KUP", "musicUrl": `${repoBaseUrl}Picasso%20Olga%20Son%20Hali.mp3`, "imageUrl": `${repoBaseUrl}Picasso%20Olga1.jpg`, "artist": "Pablo Picasso", 
                        "description": "Picasso'nun eşi Olga'yı resmettiği bu eser, Kübizm'in keskin hatlarını ve çoklu bakış açısını bir portrede birleştiriyor.", "category": "Kübist",
                        "fallbackAnalysis": "Ben, Picasso'nun aşkının ve fırtınalı ruhunun bir tuval üzerindeki yansımasıyım. Ustam, beni aynı anda hem profilden hem de cepheden çizerek, bir insanın birden çok yüzü olabileceğini gösterdi. Bu keskin çizgiler ve koyu renkler, ilişkimizin tutkusunu ve karmaşıklığını anlatır."
                    },
                    { 
                        "id": 8, "artwork": "Mona Lisa (Kübist)", "qr": "MONA_KUP", "musicUrl": `${repoBaseUrl}Monalisa%20Son%20Hali.mp3`, "imageUrl": `${repoBaseUrl}Monalisa1.jpg`, "artist": "Leonardo da Vinci (Yorum)", 
                        "description": "Klasik bir başyapıtın, 20. yüzyılın devrimci sanat akımı Kübizm ile nasıl bir araya gelebileceğini gösteren cesur bir deneme.", "category": "Kübist",
                        "fallbackAnalysis": "Yüzyıllardır süren o sakin gülümsemem, kübizmin keskin ve geometrik diliyle yeniden yorumlandı. Artık sırrım, yumuşak hatlarda değil, her bir köşede, her bir planda saklı. Ben, bir Rönesans ikonunun modern bir zihin tarafından nasıl yeniden inşa edilebileceğinin bir kanıtıyım."
                    },
                    { 
                        "id": 9, "artwork": "Olga (Klasik)", "qr": "PICA_KLASIK", "musicUrl": `${repoBaseUrl}Picasso%20Olga%20Son%20Hali.mp3`, "imageUrl": `${repoBaseUrl}Picasso%20Olga.jpg`, "artist": "Pablo Picasso", 
                        "description": "Kübist eserleriyle tanınan Picasso'nun, neoklasik döneminde yarattığı, sakin ve heykelsi bir duruşa sahip etkileyici portresi.", "category": "Klasik",
                        "fallbackAnalysis": "Picasso'nun fırçasından çıkan bir başka Olga'yım ben. Ama bu kez kübizmin parçalanmışlığında değil, antik heykellerin dinginliğinde ve anıtsallığında var oluyorum. Ustamın, modernizmin ortasında klasik güzelliğe duyduğu özlemin bir ifadesiyim."
                    }
                ];
                setAllArtworks(artworksData);
                setFilteredArtworks(artworksData);
                setIsLoading(false);
            }, []);

            useEffect(() => {
                if (filterCategory === "Tümü") setFilteredArtworks(allArtworks);
                else setFilteredArtworks(allArtworks.filter(item => item.category === filterCategory));
            }, [filterCategory, allArtworks]);

            const handleScanSuccess = (decodedText) => {
                setIsScanning(false);
                try {
                    new URL(decodedText);
                    window.open(decodedText, '_blank', 'noopener,noreferrer');
                } catch (_) {
                    const result = allArtworks.find((item) => item.qr === decodedText);
                    if (result) {
                        setSelectedArtwork(result);
                    } else {
                        setNotification("Eşleşen eser bulunamadı veya QR kod geçerli bir web sitesi değil.");
                    }
                }
            };
            
            return (
                <div className="w-full">
                    <h2 className="text-4xl font-bold text-center mb-12">Eser Galerisi</h2>
                    <div className="max-w-3xl mx-auto mb-8 sticky top-20 z-20 bg-gray-900/70 backdrop-blur-md p-4 rounded-xl border border-gray-700">
                        <div className="grid md:grid-cols-2 gap-4 items-end">
                            <div>
                                <label htmlFor="category-filter" className="block mb-2 font-medium text-gray-300">Kategoriye Göre Filtrele</label>
                                <select id="category-filter" className="w-full p-3 bg-gray-800 border border-gray-600 rounded-lg text-white" value={filterCategory} onChange={(e) => setFilterCategory(e.target.value)}>
                                    <option value="Tümü">Tümü</option>
                                    <option value="Klasik">Klasik</option>
                                    <option value="Kübist">Kübist</option>
                                </select>
                            </div>
                            <button onClick={() => setIsScanning(true)} className="w-full p-3 bg-red-600 hover:bg-red-700 text-white font-bold rounded-lg flex items-center justify-center"><CameraIcon className="mr-2" /> QR Kod Tara</button>
                        </div>
                    </div>
                    {isLoading ? <div className="text-center p-10"><LoaderIcon size={48} /></div> : <div className="grid sm:grid-cols-2 lg:grid-cols-3 gap-8 max-w-7xl mx-auto">{filteredArtworks.map((item) => <ArtCard key={item.id} item={item} onSelect={setSelectedArtwork} />)}</div>}
                    {isScanning && <QrScannerModal onScanSuccess={handleScanSuccess} onScanError={(err) => {setIsScanning(false); setNotification(err);}} onStop={() => setIsScanning(false)} />}
                    {selectedArtwork && <ArtworkDetailModal artwork={selectedArtwork} onClose={() => setSelectedArtwork(null)} />}
                </div>
            );
        };

        const ComposerView = () => ( <div className="w-full text-center"> <h2 className="text-4xl font-bold text-center mb-4">PİKSENFONİ Besteci</h2> <p className="text-center text-gray-400 mb-8">Resimlerinizden müzik yaratın. Bu özellik yakında geliyor!</p> <a href="https://sev84.github.io/Holodvision-Piksenfoni-Besteci/" target="_blank" rel="noopener noreferrer" className="inline-block bg-pink-600 hover:bg-pink-700 text-white font-bold py-3 px-8 rounded-lg shadow-lg transition-transform transform hover:scale-105">Besteciyi Ayrı Sekmede Aç</a> </div> );
        const ProjeView = () => ( <div className="w-full max-w-5xl mx-auto"> <h2 className="text-4xl font-bold text-center mb-12">Proje Hakkında</h2> <div className="grid md:grid-cols-3 gap-8 mb-16 text-center"> <div className="bg-gray-800/50 p-6 rounded-xl"> <h3 className="text-2xl font-bold text-red-300 mb-3">Amacımız</h3> <p className="text-gray-400">Görme engelli bireylerin sanata erişimini artırmak ve sanat eserlerini çoklu duyusal yollarla, özgürce deneyimlemelerini sağlamak.</p> </div> <div className="bg-gray-800/50 p-6 rounded-xl"> <h3 className="text-2xl font-bold text-red-300 mb-3">Teknolojimiz</h3> <p className="text-gray-400">RGB renk sensörlü akıllı eldiven, renkleri notalara ve titreşimlere dönüştürür. QR kod tabanlı web uygulamamız ise eserlere özel müziklere anında erişim sunar.</p> </div> <div className="bg-gray-800/50 p-6 rounded-xl"> <h3 className="text-2xl font-bold text-red-300 mb-3">Hedef Kitlemiz</h3> <p className="text-gray-400">Görme engelli bireyler, özel eğitim kurumları, müzeler, sanat galerileri ve sanata erişilebilir bir pencereden bakmak isteyen herkes.</p> </div> </div> <div className="text-center bg-gray-800/50 p-8 rounded-xl"> <h3 className="text-3xl font-bold mb-4">Renk ve Ses Eldiveni</h3> <p className="text-gray-400 max-w-2xl mx-auto mb-6">Eldiveni kullanarak tablolardaki renklere dokunun ve notaları duyun. Sanatla aranızdaki engelleri kaldırın.</p> <button className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-transform transform hover:scale-105"> ⚡ Firebase Bağlantısı Kuruldu </button> <p className="text-sm text-gray-500 mt-3">Canlı sensör verisi için "Sensör" bölümünü ziyaret edin.</p> </div> </div> );
        const IletisimView = ({ setNotification }) => {
            const [formData, setFormData] = useState({ name: '', email: '', message: '' });
            const handleChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({ ...prev, [name]: value }));
            };
            const handleSubmit = (e) => {
                e.preventDefault();
                const subject = encodeURIComponent(`PİKSENFONİ İletişim: ${formData.name}`);
                const body = encodeURIComponent(`Ad: ${formData.name}\nE-posta: ${formData.email}\n\nMesaj:\n${formData.message}`);
                window.location.href = `mailto:sevgibayram84@gmail.com?subject=${subject}&body=${body}`;
                setNotification("E-posta uygulamanız açılıyor...");
                setFormData({ name: '', email: '', message: '' });
            };
            return ( <div className="w-full max-w-2xl mx-auto text-center"> <h2 className="text-4xl font-bold mb-4">İletişim</h2> <p className="text-gray-400 mb-8">Sorularınız, geri bildirimleriniz veya işbirliği teklifleriniz için bizimle iletişime geçin.</p> <form onSubmit={handleSubmit} className="bg-gray-800/50 p-8 rounded-xl shadow-lg border border-gray-700"> <div className="mb-6 text-left"> <label htmlFor="name" className="block text-gray-300 text-sm font-bold mb-2">Adınız:</label> <input type="text" id="name" name="name" value={formData.name} onChange={handleChange} className="shadow appearance-none border border-gray-600 rounded-lg w-full py-3 px-4 text-white leading-tight focus:outline-none focus:shadow-outline bg-gray-900 placeholder-gray-500" placeholder="Adınız Soyadınız" required /> </div> <div className="mb-6 text-left"> <label htmlFor="email" className="block text-gray-300 text-sm font-bold mb-2">E-posta Adresiniz:</label> <input type="email" id="email" name="email" value={formData.email} onChange={handleChange} className="shadow appearance-none border border-gray-600 rounded-lg w-full py-3 px-4 text-white leading-tight focus:outline-none focus:shadow-outline bg-gray-900 placeholder-gray-500" placeholder="ornek@email.com" required /> </div> <div className="mb-8 text-left"> <label htmlFor="message" className="block text-gray-300 text-sm font-bold mb-2">Mesajınız:</label> <textarea id="message" name="message" value={formData.message} onChange={handleChange} rows="5" className="shadow appearance-none border border-gray-600 rounded-lg w-full py-3 px-4 text-white leading-tight focus:outline-none focus:shadow-outline bg-gray-900 placeholder-gray-500 resize-y" placeholder="Mesajınızı buraya yazın..." required ></textarea> </div> <div className="flex items-center justify-center"> <button type="submit" className="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-8 rounded-lg shadow-lg transition-transform transform hover:scale-105 focus:outline-none focus:shadow-outline flex items-center justify-center"> <MailIcon className="mr-2" /> Mesaj Gönder </button> </div> </form> </div> );
        };
        
        const LiveSensorDemoView = ({openApiModal, setNotification}) => {
            const [detectedColor, setDetectedColor] = useState({ name: 'Bekleniyor...', code: 'default' });
            const [isConnected, setIsConnected] = useState(false);
            const [isManualMode, setIsManualMode] = useState(false);
            const [colorHistory, setColorHistory] = useState([]);
            const [analysisResult, setAnalysisResult] = useState("");
            const [generatedImage, setGeneratedImage] = useState("");
            const [isLoadingAnalysis, setIsLoadingAnalysis] = useState(false);
            const audioRef = useRef(new Audio());
            const connectionTimeoutRef = useRef(null);
            const colorData = { krmz: { name: 'Kırmızı', hex: '#ef4444', sound: 'krmz' }, ysl: { name: 'Yeşil', hex: '#22c55e', sound: 'ysl' }, mavi: { name: 'Mavi', hex: '#3b82f6', sound: 'mavi' }, sari: { name: 'Sarı', hex: '#eab308', sound: 'sari' }, trnc: { name: 'Turuncu', hex: '#f97316', sound: 'trnc' }, mor: { name: 'Mor', hex: '#8b5cf6', sound: 'mor' }, pembe: { name: 'Pembe', hex: '#ec4899', sound: 'pmb' }, };
            const soundBaseUrl = "https://raw.githubusercontent.com/Sev84/Holodvision-Demo/main/";
            
            const fallbackAnalyses = [
                "Bu kompozisyon, sakin bir gün batımının melankolik tonlarını anımsatıyor. Ağır ve düşünceli notalar, sıcak renklerle birleşerek içe dönük bir an yaratıyor.",
                "Enerjik ve canlı bir başlangıç! Hızlı notalar ve parlak renkler, neşeli bir bahar sabahının coşkusunu ve umudunu yansıtıyor.",
                "Gizemli ve derin bir atmosfer... Soğuk renklerin hakimiyeti ve aralıklı, merak uyandıran notalar, gece yarısı bir ormanda yapılan keşif gezisinin heyecanını hissettiriyor.",
                "Nostaljik bir melodi bu. Pastel tonlar ve yavaş tempolu notalar, eski bir fotoğraf albümüne bakarken hissedilen tatlı bir hüznü ve anıların sıcaklığını taşıyor."
            ];

            const playColorSound = (colorInfo) => {
                if (!colorInfo || !colorInfo.sound) return;
                const audio = audioRef.current;
                if (!audio.paused) {
                    audio.pause();
                    audio.currentTime = 0;
                }
                audio.src = `${soundBaseUrl}${colorInfo.sound}.wav`;
                audio.play().catch(error => {
                    if (error.name !== 'AbortError') {
                        console.error("Renk sesi çalma hatası:", error);
                    }
                });
            };

            const handleColorChange = (colorCode) => {
                const colorInfo = colorData[colorCode.toLowerCase().trim()];
                if (!colorInfo) { 
                    setDetectedColor({ name: 'Bilinmeyen Renk', code: 'default' });
                    return; 
                }
                const newColor = { ...colorInfo, code: colorCode };
                setDetectedColor(newColor);
                playColorSound(newColor);
                setColorHistory(prevHistory => [...prevHistory, newColor].slice(-100));
            };

            const handleManualSubmit = (e) => { 
                e.preventDefault(); 
                handleColorChange(e.target.manualInput.value); 
                e.target.manualInput.value = '';
            };

            const handleAnalysis = async () => {
                const apiKey = localStorage.getItem("geminiApiKey");
                
                if (colorHistory.length === 0) {
                    setNotification("Yorum yapmak için önce renk verisi algılanmalıdır.");
                    return;
                }
                
                setIsLoadingAnalysis(true);
                setAnalysisResult("");
                setGeneratedImage("");

                if (apiKey) {
                    const colorSequence = colorHistory.map(c => c.name).join(', ');
                    const noteSequence = colorHistory.map(c => c.sound).join(' ');
                    const textPrompt = `Bir sanat ve müzik eleştirmeni olarak, aşağıdaki renk dizisi ve nota diziliminden oluşan soyut kompozisyonun duygusal tonunu yorumla. Renklerin yarattığı atmosferi, notaların çağrıştırdığı hisleri ve bu ikisinin birleşiminden doğan genel ruh halini şiirsel bir dille anlat. Yorumun kısa ve etkileyici olsun. Renkler: ${colorSequence}. Notalar: ${noteSequence}.`;
                    
                    try {
                        let chatHistory = [{ role: "user", parts: [{ text: textPrompt }] }];
                        const textPayload = { contents: chatHistory };
                        const textApiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                        
                        const textResponse = await fetch(textApiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(textPayload)
                        });
                        const textResult = await textResponse.json();
                        
                        let analysisText = "Yorum alınamadı.";
                        if (textResult.candidates && textResult.candidates[0]?.content?.parts?.[0]?.text) {
                            analysisText = textResult.candidates[0].content.parts[0].text;
                        } else if (textResult.error) {
                            throw new Error(`Metin Analizi Hatası: ${textResult.error.message}`);
                        }
                        setAnalysisResult(analysisText);
                        speakText(analysisText, localStorage.getItem("elevenLabsApiKey"));

                        const imagePrompt = `Abstract emotional digital art inspired by this feeling: "${analysisText}". The main colors are ${colorSequence}.`;
                        const imagePayload = { instances: [{ prompt: imagePrompt }], parameters: { "sampleCount": 1} };
                        const imageApiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${apiKey}`;

                        const imageResponse = await fetch(imageApiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(imagePayload)
                        });
                        const imageResult = await imageResponse.json();

                        if (imageResult.predictions && imageResult.predictions[0]?.bytesBase64Encoded) {
                            const imageUrl = `data:image/png;base64,${imageResult.predictions[0].bytesBase64Encoded}`;
                            setGeneratedImage(imageUrl);
                        } else if (imageResult.error) {
                            console.error("Görsel Üretme Hatası:", imageResult.error.message);
                            setNotification("Metin yorumlandı ancak görsel üretilemedi. API anahtarınızın faturalandırma durumuyla ilgili olabilir.");
                        }

                    } catch (error) {
                        console.error("Yapay zeka analizi veya görsel üretimi sırasında hata:", error);
                        setAnalysisResult(`Yorumlama sırasında bir hata oluştu: ${error.message}`);
                    } finally {
                        setIsLoadingAnalysis(false);
                    }
                } else {
                    const randomIndex = Math.floor(Math.random() * fallbackAnalyses.length);
                    const fallbackText = fallbackAnalyses[randomIndex];
                    setAnalysisResult(fallbackText);
                    speakText(fallbackText, localStorage.getItem("elevenLabsApiKey"));
                    setIsLoadingAnalysis(false);
                }
            };
            
            useEffect(() => { 
                connectionTimeoutRef.current = setTimeout(() => { 
                    if (!isConnected) {
                        setIsManualMode(true); 
                    }
                }, 5000); 
                
                if (window.firebaseDb && window.firebaseRef && window.firebaseOnValue) { 
                    const colorRef = window.firebaseRef(window.firebaseDb, '/sensorData/color'); 
                    const unsubscribe = window.firebaseOnValue(colorRef, (snapshot) => { 
                        if (connectionTimeoutRef.current) { 
                            clearTimeout(connectionTimeoutRef.current); 
                            connectionTimeoutRef.current = null; 
                        } 
                        setIsManualMode(false); 
                        const colorCode = snapshot.val(); 
                        if (colorCode) {
                            handleColorChange(colorCode);
                            setIsConnected(true);
                        } else { 
                            setDetectedColor({ name: 'Bekleniyor...', code: 'default' }); 
                            setIsConnected(false); 
                        } 
                    }, (error) => { 
                        console.error("Firebase'den veri okuma hatası:", error); 
                        setDetectedColor({ name: 'Hata!', code: 'default' }); 
                        setIsConnected(false); 
                        setIsManualMode(true); 
                    }); 
                    return () => { 
                        unsubscribe(); 
                        if (connectionTimeoutRef.current) { 
                            clearTimeout(connectionTimeoutRef.current); 
                        } 
                    }; 
                } else { 
                    setIsConnected(false); 
                    setIsManualMode(true); 
                } 
            }, [isConnected]);
            
            useEffect(() => { 
                const rootElement = document.getElementById('root'); 
                if (rootElement) { 
                    rootElement.style.backgroundColor = detectedColor.hex || ''; 
                } 
                return () => { 
                    const rootElement = document.getElementById('root'); 
                    if (rootElement) { 
                        rootElement.style.backgroundColor = ''; 
                    } 
                } 
            }, [detectedColor]);

            const pixelGrid = Array.from({ length: 100 }, (_, i) => colorHistory[i] || null);

            return ( 
                <div className="w-full max-w-4xl mx-auto text-center flex flex-col">
                    <div className="flex-grow">
                        <h1 className="text-4xl font-bold text-white mb-2">Canlı Sensör Verisi</h1>
                        <p className="text-gray-400 mb-6">Deneyap Kart'tan gelen canlı renk verisi burada gösterilir.</p>
                        {isManualMode ? ( 
                            <div className="p-6 bg-gray-900/70 rounded-xl shadow-lg border border-red-500">
                                <p className="text-lg text-red-300 mb-4"> Firebase bağlantısı kurulamadı. Manuel simülasyon modundasınız. </p>
                                <form onSubmit={handleManualSubmit} className="flex flex-col sm:flex-row gap-4 mb-6">
                                    <input type="text" id="manualInput" name="manualInput" placeholder="Örn: krmz, mavi, ysl..." className="flex-grow p-3 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-red-500" />
                                    <button type="submit" className="p-3 bg-red-600 hover:bg-red-700 text-white font-bold rounded-lg">Renk Gönder</button>
                                </form>
                                <p className="text-lg text-gray-300"> Algılanan renk: <strong className="font-bold text-2xl" style={{color: detectedColor.hex || '#a78bfa' }}>{detectedColor.name}</strong> </p>
                            </div> 
                        ) : ( 
                            <div className="p-6 bg-gray-900/70 rounded-xl shadow-lg border border-gray-700">
                                <p className="text-lg text-gray-300 mb-4"> Bağlantı Durumu: <strong className={`font-bold text-xl ${isConnected ? 'text-green-400' : 'text-red-400'}`}>{isConnected ? 'Bağlı' : 'Bağlı Değil'}</strong> </p>
                                <p className="text-lg text-gray-300"> Algılanan renk: <strong className="font-bold text-2xl" style={{color: detectedColor.hex || '#a78bfa' }}>{detectedColor.name}</strong> </p>
                            </div> 
                        )}
                    </div>
                    
                    <div className="mt-8 w-full">
                        <h3 className="text-2xl font-bold text-white mb-4">Piksel Defteri</h3>
                        <div className="bg-gray-900/50 p-4 rounded-xl border border-gray-700 aspect-square w-full max-w-md mx-auto">
                            <div className="grid grid-cols-10 grid-rows-10 h-full gap-1">
                                {pixelGrid.map((color, index) => (
                                    <div 
                                        key={index}
                                        className="w-full h-full rounded"
                                        style={{ backgroundColor: color ? color.hex : '#1f2937' }}
                                        title={color ? color.name : 'Boş'}
                                    ></div>
                                ))}
                            </div>
                        </div>
                    </div>

                    <div className="mt-8 w-full">
                        <h3 className="text-2xl font-bold text-white mb-4">Nota Terminali</h3>
                        <div className="bg-black font-mono text-left p-4 rounded-xl w-full max-w-md mx-auto border border-gray-700 h-48 overflow-y-auto">
                            <p className="text-green-400 break-words">
                                {colorHistory.map(c => `${c.name}(${c.sound}) ♪ `).join('')}
                                <span className="blinking-cursor">█</span>
                            </p>
                        </div>
                    </div>

                    <div className="mt-8 w-full max-w-md mx-auto">
                        <button onClick={handleAnalysis} disabled={isLoadingAnalysis} className="w-full bg-gradient-to-r from-teal-500 to-cyan-500 hover:from-teal-600 hover:to-cyan-600 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                            {isLoadingAnalysis ? <LoaderIcon /> : <SparklesIcon className="mr-2" />}
                            {isLoadingAnalysis ? "Yorumlanıyor..." : "Kompozisyonu Yorumla"}
                        </button>
                    </div>
                    
                    {generatedImage && (
                         <div className="mt-8 w-full max-w-md mx-auto">
                             <h3 className="text-2xl font-bold text-white mb-4">Yapay Zeka Görseli</h3>
                             <div className="bg-gray-900/50 p-4 rounded-xl border border-gray-700">
                                 <img src={generatedImage} alt="Yapay zeka tarafından üretilen görsel" className="w-full h-auto rounded-lg"/>
                             </div>
                         </div>
                    )}

                    {analysisResult && !isLoadingAnalysis && (
                        <div className="mt-4 w-full max-w-md mx-auto">
                             <h3 className="text-2xl font-bold text-white mb-4">Yapay Zeka Yorumu</h3>
                            <div className="bg-gray-900/70 p-4 rounded-xl text-left">
                                <p className="text-gray-300 whitespace-pre-wrap">{analysisResult}</p>
                            </div>
                        </div>
                    )}

                </div>
            ); 
        };

        // --- ANA UYGULAMA BİLEŞENİ ---
        const App = () => {
            const [activeView, setActiveView] = useState("home");
            const [notification, setNotification] = useState(null);
            const [isExperienceStarted, setIsExperienceStarted] = useState(false);
            const [isMusicPlaying, setIsMusicPlaying] = useState(false);
            const [bgMusicVolume, setBgMusicVolume] = useState(0.3);
            const [isApiModalOpen, setIsApiModalOpen] = useState(false);
            const [onlineUsersList, setOnlineUsersList] = useState([]);
            const [totalVisits, setTotalVisits] = useState(0);
            const [isStatsModalOpen, setIsStatsModalOpen] = useState(false);
            const bgMusicRef = useRef(null);
            const introAudioRef = useRef(null);

            useEffect(() => {
                bgMusicRef.current = new Audio("https://raw.githubusercontent.com/Sev84/Holodvision-Demo/main/fon%20muzik.mp3");
                bgMusicRef.current.loop = true;

                const db = window.firebaseDb;
                const presenceRef = window.firebaseRef(db, 'presence');
                const connectionsRef = window.firebaseRef(db, 'connections');
                const myConnectionId = window.firebasePush(connectionsRef).key;
                const myConnectionRef = window.firebaseRef(db, `presence/${myConnectionId}`);

                window.firebaseOnValue(window.firebaseRef(db, '.info/connected'), (snap) => {
                    if (snap.val() === true) {
                        window.firebaseSet(myConnectionRef, { online: true, loginTime: window.serverTimestamp() });
                        window.firebaseOnDisconnect(myConnectionRef).remove();
                    }
                });

                window.firebaseOnValue(presenceRef, (snap) => {
                    const users = [];
                    snap.forEach(childSnap => {
                        users.push({id: childSnap.key, ...childSnap.val()});
                    });
                    setOnlineUsersList(users);
                });

                window.firebaseOnValue(connectionsRef, (snap) => {
                    setTotalVisits(snap.size);
                });

            }, []);

            useEffect(() => {
                if (bgMusicRef.current) {
                    bgMusicRef.current.volume = bgMusicVolume;
                }
            }, [bgMusicVolume]);

            const handleWelcomeStart = () => {
                setIsExperienceStarted(true);
                introAudioRef.current = new Audio("https://raw.githubusercontent.com/Sev84/Holodvision-Demo/main/Tanıtım1.mp3");
                introAudioRef.current.play().catch(e => console.error("Giriş sesi çalma hatası:", e));
                
                bgMusicRef.current.play().catch(e => {
                    console.error("Arka plan müziği çalma hatası:", e);
                    setIsMusicPlaying(false);
                });
                setIsMusicPlaying(true);
            };

            const stopAllAudio = () => {
                window.speechSynthesis.cancel();
                if (introAudioRef.current && !introAudioRef.current.paused) {
                    introAudioRef.current.pause();
                    introAudioRef.current.currentTime = 0;
                }
            };

            const toggleMusic = () => {
                const audio = bgMusicRef.current;
                if (isMusicPlaying) {
                    audio.pause();
                } else {
                    audio.play().catch(e => console.error("Müzik geçiş hatası:", e));
                }
                setIsMusicPlaying(!isMusicPlaying);
            };
            
            const handleVolumeChange = (e) => {
                setBgMusicVolume(parseFloat(e.target.value));
            };
            
            const handleSaveApiKeys = (keys) => {
                localStorage.setItem("geminiApiKey", keys.gemini);
                localStorage.setItem("elevenLabsApiKey", keys.elevenLabs);
                setNotification("API Anahtarları başarıyla kaydedildi!");
            };

            const clearNotification = () => setNotification(null);

            if (!isExperienceStarted) {
                return <WelcomeScreen onStart={handleWelcomeStart} />;
            }

            return (
                <div className="min-h-screen text-white">
                    <nav className="fixed top-0 left-0 right-0 bg-gray-900/80 backdrop-blur-md z-30 shadow-lg py-3 px-6 flex justify-between items-center rounded-b-xl border-b border-gray-700">
                        <div className="flex items-center">
                            <img src="https://raw.githubusercontent.com/Sev84/Holodvision-Demo/main/logo1111111.png" alt="PİKSENFONİ Logosu" className="h-10 mr-3"/>
                            <span className="text-xl font-bold text-pink-400 hidden md:block">PİKSENFONİ</span>
                        </div>
                        <div className="flex-grow flex justify-center items-center space-x-1 sm:space-x-2 md:space-x-4">
                            <button onMouseEnter={() => speakText("Ana Sayfa", localStorage.getItem("elevenLabsApiKey")).catch(e => {})} onClick={() => setActiveView("home")} className={`px-2 py-2 md:px-3 rounded-lg transition-colors flex items-center text-sm ${activeView === "home" ? 'bg-red-600 text-white' : 'text-gray-300 hover:bg-gray-700'}`} title="Ana Sayfa"><HomeIcon className="mr-0 sm:mr-1 h-5 w-5" /> <span className="hidden sm:inline">Ana Sayfa</span></button>
                            <button onMouseEnter={() => speakText("Galeri", localStorage.getItem("elevenLabsApiKey")).catch(e => {})} onClick={() => setActiveView("gallery")} className={`px-2 py-2 md:px-3 rounded-lg transition-colors flex items-center text-sm ${activeView === "gallery" ? 'bg-red-600 text-white' : 'text-gray-300 hover:bg-gray-700'}`} title="Galeri"><EyeIcon className="mr-0 sm:mr-1 h-5 w-5" /> <span className="hidden sm:inline">Galeri</span></button>
                            <button onMouseEnter={() => speakText("Besteci", localStorage.getItem("elevenLabsApiKey")).catch(e => {})} onClick={() => setActiveView("composer")} className={`px-2 py-2 md:px-3 rounded-lg transition-colors flex items-center text-sm ${activeView === "composer" ? 'bg-red-600 text-white' : 'text-gray-300 hover:bg-gray-700'}`} title="Besteci"><MusicIcon className="mr-0 sm:mr-1 h-5 w-5" /> <span className="hidden sm:inline">Besteci</span></button>
                            <button onMouseEnter={() => speakText("Sensör", localStorage.getItem("elevenLabsApiKey")).catch(e => {})} onClick={() => setActiveView("sensor")} className={`px-2 py-2 md:px-3 rounded-lg transition-colors flex items-center text-sm ${activeView === "sensor" ? 'bg-red-600 text-white' : 'text-gray-300 hover:bg-gray-700'}`} title="Sensör"><RssIcon className="mr-0 sm:mr-1 h-5 w-5" /> <span className="hidden sm:inline">Sensör</span></button>
                            <button onMouseEnter={() => speakText("Proje", localStorage.getItem("elevenLabsApiKey")).catch(e => {})} onClick={() => setActiveView("project")} className={`px-2 py-2 md:px-3 rounded-lg transition-colors flex items-center text-sm ${activeView === "project" ? 'bg-red-600 text-white' : 'text-gray-300 hover:bg-gray-700'}`} title="Proje"><FileTextIcon className="mr-0 sm:mr-1 h-5 w-5" /> <span className="hidden sm:inline">Proje</span></button>
                            <button onMouseEnter={() => speakText("İletişim", localStorage.getItem("elevenLabsApiKey")).catch(e => {})} onClick={() => setActiveView("contact")} className={`px-2 py-2 md:px-3 rounded-lg transition-colors flex items-center text-sm ${activeView === "contact" ? 'bg-red-600 text-white' : 'text-gray-300 hover:bg-gray-700'}`} title="İletişim"><MailIcon className="mr-0 sm:mr-1 h-5 w-5" /> <span className="hidden sm:inline">İletişim</span></button>
                        </div>
                        <div className="flex items-center space-x-3">
                             <button onClick={() => setIsStatsModalOpen(true)} className="flex items-center gap-2 text-gray-400 hover:text-white transition-colors" title="Ziyaretçi İstatistikleri">
                                <UsersIcon />
                                <span>{onlineUsersList.length}</span>
                            </button>
                            <button onClick={stopAllAudio} className="p-2 rounded-full text-gray-300 hover:bg-gray-700 transition-colors" title="Seslendirmeyi Durdur">
                                <MicOffIcon />
                            </button>
                            <button onClick={() => setIsApiModalOpen(true)} className="p-2 rounded-full text-gray-300 hover:bg-gray-700 transition-colors" title="Ayarlar">
                                <SettingsIcon />
                            </button>
                            <button onClick={toggleMusic} className="p-2 rounded-full text-gray-300 hover:bg-gray-700 transition-colors" title={isMusicPlaying ? "Müziği Durdur" : "Müziği Başlat"}>
                                {isMusicPlaying ? <Volume2Icon /> : <VolumeXIcon />}
                            </button>
                            <input 
                                type="range" 
                                min="0" 
                                max="1" 
                                step="0.01" 
                                value={bgMusicVolume} 
                                onChange={handleVolumeChange}
                                className="w-16 md:w-24"
                                title="Ses Seviyesi"
                            />
                        </div>
                    </nav>

                    <main className="pt-24 pb-8">
                        <div style={{ display: activeView === "home" ? 'block' : 'none' }}><AnimatedSection><AnaSayfaView /></AnimatedSection></div>
                        <div style={{ display: activeView === "gallery" ? 'block' : 'none' }}><AnimatedSection><GalleryView setNotification={setNotification} /></AnimatedSection></div>
                        <div style={{ display: activeView === "composer" ? 'block' : 'none' }}><AnimatedSection><ComposerView /></AnimatedSection></div>
                        <div style={{ display: activeView === "sensor" ? 'block' : 'none' }}><AnimatedSection><LiveSensorDemoView openApiModal={() => setIsApiModalOpen(true)} setNotification={setNotification} /></AnimatedSection></div>
                        <div style={{ display: activeView === "project" ? 'block' : 'none' }}><AnimatedSection><ProjeView /></AnimatedSection></div>
                        <div style={{ display: activeView === "contact" ? 'block' : 'none' }}><AnimatedSection><IletisimView setNotification={setNotification} /></AnimatedSection></div>
                    </main>

                    <ApiKeyModal isOpen={isApiModalOpen} onClose={() => setIsApiModalOpen(false)} onSave={handleSaveApiKeys} />
                    <VisitorStatsModal isOpen={isStatsModalOpen} onClose={() => setIsStatsModalOpen(false)} onlineUsers={onlineUsersList} totalVisits={totalVisits} />
                    <Notification message={notification} onClear={clearNotification} />
                </div>
            );
        };

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
